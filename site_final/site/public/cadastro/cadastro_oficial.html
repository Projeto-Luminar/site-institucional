<!DOCTYPE html>
<html lang="ptbr">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro</title>
    <link rel="shortcut icon" href="./icones/luz.png" type="image/x-icon">
    <link rel="stylesheet" href="./cadastro_oficial.css">
</head>

<body>
    <header>
        <div class="header-luminar">
            <div class="logo-luminar">
                <a href="/index.html">
                    <img src="./icones/logoLuminar.png" alt="Logo Luminar" width="160px" />
                </a>
            </div>
            <nav>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../index.html#servicos_redirecionar">Serviços</a></li>
                    <li><a href="../index.html#sobrenos1">Sobre Nós</a></li>
                    <li><a href="../index.html#fale-conosco">Fale Conosco</a></li>
                </ul>
            </nav>
            <div class="btn-login-cadastro">
                <a href="../login/login.html" class="btn-login">Fazer Login</a>
                <a href="../cadastro/cadastro.html" class="btn-cadastro"><b>Cadastre-se</b></a>
            </div>
        </div>
        <div class="linha-header">
        </div>
    </header>

    <div class="container_cadastro">
        <div class="box_cad">
            <div class="box_left">
                <div class="texto_box_left">
                    <h2>Crie uma conta <b>Gratuita!</b></h2>
                    <p>Cadastre-se para ter acesso aos nossos serviços!</p>
                </div>
                <div class="img_box">
                    <img src="./icones/Vector.png" alt="">
                </div>
                <h3 class="frase-experiencia"> Sua melhor expêriencia começa aqui!</h3>
            </div>

            <div class="form_box">
                <div class="dados-empresa">
                    <p>Preencha os dados da sua empresa:</p>
                </div>
                <div class="input_group">
                    <label for="input_nome_empresa"> Nome da empresa <b>*</b></label>
                    <input onkeyup="verificar_nome_e()" type="text" name="nome_empresa" id="input_nome_empresa"
                        placeholder="Digite o nome da empresa">
                </div>

                <div class="telefone-cnpj">
                    <div class="input_group cnpj">
                        <label for="input_cnpj">CNPJ <b>*</b></label>
                        <input onkeyup="verificar_cnpj()" type="text" name="cnpj" id="input_cnpj" placeholder="XXXXXXXX0001-XX">
                        <div class="erro" id="div_erro_cnpj"></div>
                    </div>
                    <div class="input_group telefone">
                        <label for="input_telefone">Telefone <b>*</b></label>
                        <input onkeyup="verificar_telefone()" type="text" name="telefone" id="input_telefone" placeholder="(XX)9XXXXXXXX">
                        <div class="erro" id="div_erro_telefone"></div>
                    </div>
                </div>

                <div class="cep-numero">
                    <div class="input_group cep">
                        <label for="input_cep">CEP <b>*</b></label>
                        <input onkeyup="verificar_cep()" type="text" name="cep" id="input_cep" placeholder="XXXXX-XXX">
                        <div class="erro" id="div_erro_cep"></div>
                    </div>

                    <div class="input_group  numero">
                        <label for="input_numero_endereco">Número <b>*</b></label>
                        <input onkeyup="verificar_num_endereco()" type="number" name="Numero" id="input_numero_endereco" placeholder="Número do endereço">
                    </div>
                </div>

                <div class="dados-funcionario">
                    <p>Preencha os seus dados cadastrais:</p>
                </div>

                <div class="input_group ">
                    <label for="input_nome">Nome <b>*</b></label>
                    <input onkeyup="verificar_nome()" type="text" name="nome" id="input_nome" placeholder="Digite seu nome completo">
                </div>

                <div class="input_group">
                    <label for="input_email">E-mail <b>*</b></label>
                    <input onkeyup="verificar_email()" type="text" name="email" id="input_email" placeholder="nome@exemplo.com">
                </div>

                <div class="erro" id="div_erro_email"></div>

                <div class="senha-confirmacaoSenha">
                    <div class="input_group senha">
                        <label for="input_senha">Senha <b>*</b></label>
                        <input onkeyup="verificar_senha()" type="password" name="senha" id="input_senha" placeholder="Digite sua senha">
                        <div class="erro" id="div_erro_senha"></div>
                    </div>
                    <div class="input_group confirmacao-senha">
                        <label for="input_confirmacao_senha">Confirme sua senha<b>*</b></label>
                        <input onkeyup="confirmar_senha()" type="password" name="senha" id="input_confirmacao_senha"
                            placeholder="Digite sua senha novamente">
                        <div class="erro" id="div_erro_confirm_senha"></div>
                    </div>
                </div>

                <div class="input_group">
                    <button onclick="cadastrar()">
                        Enviar
                    </button>
                </div>
                <div class="moments">
                    <p>Já tem uma conta? <a href="../login/login.html">Faça seu login<p></a>
                </div>
            </div>
        </div>
    </div>
    </div>
</body>

</html>

<script>
    function verificar_nome() {
        var nomeServer = input_nome.value;
        if (nomeServer == "") {
            document.getElementById("input_nome").style.borderColor = "black"
        } else if (nomeServer.length >= 3) {
            document.getElementById("input_nome").style.borderColor = "green"
        } else {document.getElementById("input_nome").style.borderColor = "red"}
    }

    function verificar_email(){
        var emailServer = input_email.value;

        if (emailServer == "") {
            document.getElementById("input_email").style.borderColor = "black"
        } else if (emailServer.indexOf("@") > -1 && (emailServer.indexOf("sptech.school") > -1 || emailServer.indexOf(".com") > -1 || emailServer.indexOf(".com.br") > -1)) {
            document.getElementById("input_email").style.borderColor = "green";
        } else {document.getElementById("input_email").style.borderColor = "red";}
    }

    function verificar_senha(){
        var senhaVar = input_senha.value;
        confirmar_senha()

        if (senhaVar == "") {
            document.getElementById("input_senha").style.borderColor = "black";
        } else if (senhaVar.length < 8) {
            document.getElementById("input_senha").style.borderColor = "red";
        } else {document.getElementById("input_senha").style.borderColor = "green";}
    }

    function confirmar_senha() {
        var senhaVar = input_senha.value;
        var senha_confirm = input_confirmacao_senha.value;

        if (senha_confirm == "") {
            document.getElementById("input_confirmacao_senha").style.borderColor = "black";
        } else if (senhaVar == senha_confirm) {
            document.getElementById("input_confirmacao_senha").style.borderColor = "green";
        } else {document.getElementById("input_confirmacao_senha").style.borderColor = "red";}
    }
    
    function verificar_nome_e() {
        var nome_empresaVar = input_nome_empresa.value;
        if (nome_empresaVar == "") {
            document.getElementById("input_nome_empresa").style.borderColor = "black";
        } else if (nome_empresaVar.length > 2) {
            document.getElementById("input_nome_empresa").style.borderColor = "green";
        } else {document.getElementById("input_nome_empresa").style.borderColor = "red";}
    }

    function verificar_telefone() {
        var telefoneVar = input_telefone.value;
        if (telefoneVar == "") {
            document.getElementById("input_telefone").style.borderColor = "black";
        } else if (telefoneVar.indexOf("(11)9") > -1 && telefoneVar.length == 13) {
            document.getElementById("input_telefone").style.borderColor = "green";
        } else {document.getElementById("input_telefone").style.borderColor = "red";}
    }

    function verificar_cnpj() {
        var cnpjVar = input_cnpj.value;

        if (cnpjVar == "") {
            document.getElementById("input_cnpj").style.borderColor = "black";
        } else if (cnpjVar.indexOf("0001-") > -1 && cnpjVar.length == 15) {
            document.getElementById("input_cnpj").style.borderColor = "green";
        } else {document.getElementById("input_cnpj").style.borderColor = "red";}
    }

    
    function verificar_cep() {
        var cepVar = input_cep.value;
        if (cepVar == "") {
            document.getElementById("input_cep").style.borderColor = "black";
        } else if (cepVar.indexOf('-') > -1 && cepVar.length == 9) {
            document.getElementById("input_cep").style.borderColor = "green";
        } else {document.getElementById("input_cep").style.borderColor = "red";}
    }
    
    function verificar_num_endereco() {
        var num_eVar = input_numero_endereco.value;

        if (num_eVar == "") {
            document.getElementById("input_numero_endereco").style.borderColor = "black";
        } else if (num_eVar.length > 1) {
            document.getElementById("input_numero_endereco").style.borderColor = "green";
        } else {document.getElementById("input_numero_endereco").style.borderColor = "red";}
    }


    function cadastrar() {

        // Recuperando o valor do ID da INPUT
        // Após isso ir ao método FETCH abaixo
        var nomeUserVar = input_nome.value;
        var telefoneVar = input_telefone.value;
        var emailVar = input_email.value;
        var senhaVar = input_senha.value;
        var confirmacaoSenhaVar = input_confirmacao_senha.value;
        var nome_empresaVar = input_nome_empresa.value;
        var cnpjVar = input_cnpj.value;
        var cepVar = input_cep.value;
        var numero_enderecoVar = input_numero_endereco.value;


        if (nomeUserVar == "" || telefoneVar == "" || emailVar == "" || senhaVar == "" || confirmacaoSenhaVar == "" || nome_empresaVar == "" || cnpjVar == "" || cepVar == "" || numero_enderecoVar == "") {
            
            alert(`Preeencha todos os campos!`);

            return false;
        } else if (nomeUserVar.length <= 3) {
            alert("O nome deve ter mais de 2 caracteres");
        } else if (emailVar.indexOf("@") == -1 || (emailVar.indexOf("sptech.school") == -1 && emailVar.indexOf(".com") == -1 && emailServer.indexOf(".com.br") == -1)) {
            alert("E-mail inválido!");
        } else if (senhaVar.length < 8) {
            alert("Sua senha deve ter no mínimo 8 caracteres");
        } else if (senhaVar != confirmacaoSenhaVar) {
            alert(`A confirmação de senha está incorreta`);
        } else if (telefoneVar.indexOf("(11)9") == -1 || telefoneVar.length > 13 && telefoneVar.length <= 13) {
            alert("O número deve conter 11 dígitos e '-9' após o DDD")
        } else if (cnpjVar.indexOf("0001-") == -1 || cnpjVar.length > 15 && cnpjVar.length <= 15) {
            alert("O CNPJ deve conter 14 dígitos e '0001-' antes dos dois dígitos finais.");
        } else if (cepVar.indexOf('-') == -1 || cepVar.length > 9 && cepVar.length <= 9) {
            alert('O CEP deve ter 8 dígitos e conter um - antes dos 3 dígitos finais')
        }else {
         // Enviando o valor da nova input
        fetch("/usuarios/cadastrarEmpresa", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // Colocar o nome da variável que foi criada acima
                // Agora vá para o arquivo routes/usuario.js (EM src)
                nome_empresaServer: nome_empresaVar,
                cnpjServer: cnpjVar,
                telefoneServer: telefoneVar,
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {

                fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // Colocar o nome da variável que foi criada acima
                // Agora vá para o arquivo routes/usuario.js (EM src)
                nomeUserServer: nomeUserVar,
                emailServer: emailVar,
                senhaServer: senhaVar
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {

                fetch("/usuarios/cadastrarEndereco", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // Colocar o nome da variável que foi criada acima
                // Agora vá para o arquivo routes/usuario.js (EM src)
                cepServer: cepVar,
                numeroServer: numero_enderecoVar
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {

                setTimeout(() => {
                    window.location = "../login/login.html";
                }, "2000")
        
            } else {
                throw ("Houve um erro ao tentar realizar o endereço!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

        return false;
        
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro da empresa!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

        return false;   
        
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro de usuário!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

        return false;   
        }
    }
</script>