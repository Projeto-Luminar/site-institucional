<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro</title>
    <link rel="shortcut icon" href="./icones/luz.png" type="image/x-icon">
    <script src="../js/funcoes.js"></script>
    <link rel="stylesheet" href="./cadastro.css">
</head>

<body>
    <!-- CONTEUDO -->

    <header>
        <div class="header-luminar">
            <div class="logo-luminar">
                <a href="../index.html">
                    <img src="./icones/logoLuminar.png" alt="Logo Luminar" width="160px" />
                </a>
            </div>
            <nav>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../index.html#servicos_redirecionar">Serviços</a></li>
                    <li><a href="../index.html#sobrenos1">Sobre Nós</a></li>
                    <li><a href="../index.html#fale-conosco">Fale Conosco</a></li>
                </ul>
            </nav>
            <div class="btn-login-cadastro">
                <a href="../login/login.html" class="btn-login">Fazer Login</a>
                <a href="../cadastro/cadastro.html" class="btn-cadastro"><b>Cadastre-se</b></a>
            </div>
        </div>
        <div class="linha-header">
        </div>
    </header>

    <div class="container_cadastro">
        <div class="box_cad">
            <div class="titulo_cadastro">
                <h2>Crie uma conta <b>Gratuita!</b></h2>
                <h4>Cadastre-se para ter acesso aos nossos serviços!</h4>
            </div>
            <div class="formularios">
            <div class="form_box2">

                <!-- Aqui começam os inputs e suas verificações pelo ID 
                    (a label tinha um "for" da seguinte forma: 
                    for="input_nome" -- Porém essa classe não era utilizada em lugar algum, por isso foi retirada)
                -->



                    <!-- Aqui começa o formulário do usuário, até a confirmação de senha -->
                    <div class="input_group">
                        <label>Nome <b>*</b></label>
                        <input type="text" name="nome" id="nome_input" placeholder="Seu nome">
                    </div>

                    <div class="input_group ">
                        <label>Sobrenome <b>*</b></label>
                        <input type="text" name="sobrenome" id="sobrenome_input" placeholder="Sobrenome">
                    </div>

                <div class="input_group">
                    <label>Telefone <b>*</b></label>
                    <input type="text" name="telefone" id="telefone_input" placeholder="XX-9XXXXXXXX">
                </div>

                <div class="input_group">
                    <label>CPF <b>*</b></label>
                    <input type="text" name="cpf" id="cpf_input" placeholder="000000000-00">
                </div>

                <div class="input_group">
                    <label>E-mail <b>*</b></label>
                    <input type="text" name="email" id="email_input" placeholder="nome@exemplo.com">
                </div>

                <div class="input_group">
                    <label>Senha <b>*</b></label>
                    <input type="password" name="password" id="senha_input" placeholder="No mínimo 8 caracteres">
                </div>

                <div class="input_group">
                    <label>Confirmação de senha <b>*</b></label>
                    <input type="password" name="password" id="confirmacao_senha_input" placeholder="Digite sua senha novamente">
                </div>
            </div>




            <!-- Aqui, termina a parte do formulário do usuário, 
                e começa a parte do formulário da empresa junto ao endereço(???) -->

            <div class="form_box">    
                    <div class="input_group">
                        <label>Nome da empresa <b>*</b></label>
                        <input type="text" name="nome_empresa" id="nome_empresa_input" placeholder="Nome da empresa">
                    </div>

                    <div class="input_group">
                        <label>CNPJ <b>*</b></label>
                        <input type="text" name="cnpj" id="cnpj_input" placeholder="XXXXXXXX0001-XX">
                    </div>
                    <div class="input_group">
                        <label>Rua <b>*</b></label>
                        <input type="text" name="rua" id="rua_input"
                            placeholder="Rua da sua empresa">
                    </div>

                    <div class="input_group">
                        <label>CEP <b>*</b></label>
                        <input type="text" name="cep" id="cep_input" placeholder="00000-000">
                    </div>

                    <div class="input_group">
                        <label>Número da sua empresa <b>*</b></label>
                        <input type="number" name="numero" id="numero_input" placeholder="123">
                    </div>

                    <div class="input_group">
                        <label>Cidade<b>*</b></label>
                        <input type="text" name="cidade" id="cidade_input" placeholder="São Paulo">
                    </div>

                    <div class="input_group">
                        <label>Estado<b>*</b></label>
                        <input type="text" name="estado" id="estado_input" placeholder="SP">
                    </div>
            </div>
        </div>
<!-- termina o formulário empresa e endereço-->


        <div class="input_group">
            <button onclick="cadastrar()">
                Enviar
            </button>
        </div>
            <h3 class="frase-experiencia"> Sua melhor expêriencia começa aqui!</h3>
                    <div class="moments">
                        <p>
                        <h4>Já tem uma conta? <a href="../login/login.html">Faça login na Luminar</h4></a></p>
                    </div>
    </div>
</body>

</html>

<script>
    function cadastrar() {
        aguardar();

        // Recuperando o valor do ID da INPUT
        // Após isso ir ao método FETCH abaixo
        var nomeVar = nome_input.value;
        var sobrenomeVar = sobrenome_input.value;
        var telefoneVar = telefone_input.value;
        var cpfVar = cpf_input.value;
        var emailVar = email_input.value;
        var senhaVar = senha_input.value;
        var confirmacaoSenhaVar = confirmacao_senha_input.value;
        var nome_empresaVar = nome_empresa_input.value;
        var cnpjVar = cnpj_input.value;
        var ruaVar = rua_input.value;
        var cepVar = cep_input.value;
        var numeroVar = numero_input.value;
        var cidadeVar = cidade_input.value;
        var estadoVar = estado_input.value;


        if (nomeVar == "" || sobrenomeVar == "" || telefoneVar == "" || cpfVar == "" || emailVar == "" || senhaVar == "" || confirmacaoSenhaVar == "" || nome_empresaVar == "" || cnpjVar == "" || ruaVar == "" || cepVar == "" || numeroVar == "" || cidadeVar == "" || estadoVar == "") {
            cardErro.style.display = "block"
            mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";

            finalizarAguardar();
            return false;
        }
        else {
            setInterval(sumirMensagem, 5000)
        }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // Colocar o nome da variável que foi criada acima
                // Agora vá para o arquivo routes/usuario.js (EM src)
                nomeServer: nomeVar,
                sobrenomeServer: sobrenomeVar,
                telefoneServer: telefoneVar,
                cpfServer: cpfVar,
                emailServer: emailVar,
                senhaServer: senhaVar,
                confirmacaoSenhaServer: confirmacaoSenhaVar,
                nome_empresaServer: nome_empresaVar,
                cnpjServer: cnpjVar,
                ruaServer: ruaVar,
                cepServer: cepVar,
                numeroServer: numeroVar,
                cidadeServer: cidadeVar,
                estadoServer: estadoVar
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                cardErro.style.display = "block";

                mensagem_erro.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                setTimeout(() => {
                    window.location = "login.html";
                }, "2000")
                
                limparFormulario();
                finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;
    }

    function sumirMensagem() {
        cardErro.style.display = "none"
    }

</script>











<!-- VERIFICAÇÕES ANTIGAS COMENTADAS ABAIXO POR MOTIVOS DE:
A lógica apresentada funciona, algumas coisas apresentam erros, outras simplesmente 
confunde e entra em conflito com os arquivos da API.
JS ESTÁ EXTREMAMENTE EXTENSO -->
<!-- 
<script>
    function verificar_nome() {
        var nomeServer = input_nome.value;
        if (nomeServer == "") {
            document.getElementById("input_nome").style.borderColor = "black"
        } else if (nomeServer.length >= 3) {
            document.getElementById("input_nome").style.borderColor = "green"
        } else {document.getElementById("input_nome").style.borderColor = "red"}
    }

    function verificar_sobrenome() {
        var sobrenomeServer = input_sobrenome.value;

        if (sobrenomeServer == "") {
            document.getElementById("input_sobrenome").style.borderColor = "black"
        } else if (sobrenomeServer.length >= 3) {
            document.getElementById("input_sobrenome").style.borderColor = "green"
        } else {document.getElementById("input_sobrenome").style.borderColor = "red"}
    }

    function verificar_email(){
        var emailServer = input_email.value;

        if (emailServer == "") {
            document.getElementById("input_email").style.borderColor = "black"
        } else if (emailServer.indexOf("@") > -1 && (emailServer.indexOf("sptech.school") > -1 || emailServer.indexOf(".com") > -1 || emailServer.indexOf(".com.br") > -1)) {
            document.getElementById("input_email").style.borderColor = "green";
        } else {document.getElementById("input_email").style.borderColor = "red";}
    }

    function verificar_senha(){
        var senhaServer = input_senha.value;
        confirmar_senha()

        if (senhaServer == "") {
            document.getElementById("input_senha").style.borderColor = "black";
        } else if (senhaServer.length < 8) {
            document.getElementById("input_senha").style.borderColor = "red";
        } else {document.getElementById("input_senha").style.borderColor = "green";}
    }

    function confirmar_senha() {
        var senhaServer = input_senha.value;
        var senha_confirm = input_senha_confirmacao.value;

        if (senha_confirm == "") {
            document.getElementById("input_senha_confirmacao").style.borderColor = "black";
        } else if (senhaServer == senha_confirm) {
            document.getElementById("input_senha_confirmacao").style.borderColor = "green";
        } else {document.getElementById("input_senha_confirmacao").style.borderColor = "red";}
    }
    
    function verificar_nome_e() {
        var nome_empresaServer = input_nome_empresa.value;
        if (nome_empresaServer == "") {
            document.getElementById("input_nome_empresa").style.borderColor = "black";
        } else if (nome_empresaServer.length > 2) {
            document.getElementById("input_nome_empresa").style.borderColor = "green";
        } else {document.getElementById("input_nome_empresa").style.borderColor = "red";}
    }

    function verificar_telefone() {
        var telefoneServer = input_telefone.value;
        if (telefoneServer == "") {
            document.getElementById("input_telefone").style.borderColor = "black";
        } else if (telefoneServer.indexOf("-9", 2) > -1 && telefoneServer.length == 12) {
            document.getElementById("input_telefone").style.borderColor = "green";
        } else {document.getElementById("input_telefone").style.borderColor = "red";}
    }

    function verificar_cnpj() {
        var cnpjServer = input_cnpj.value;

        if (cnpjServer == "") {
            document.getElementById("input_cnpj").style.borderColor = "black";
        } else if (cnpjServer.indexOf("0001-") > -1 && cnpjServer.length == 15) {
            document.getElementById("input_cnpj").style.borderColor = "green";
        } else {document.getElementById("input_cnpj").style.borderColor = "red";}
    }

    function verificar_cpf() {
        var cpfServer = input_cpf.value;

        if (cpfServer == "") {
            document.getElementById("input_cpf").style.borderColor = "black";
        } else if (cpfServer.indexOf("-") > -1 && cpfServer.length == 12) {
            document.getElementById("input_cpf").style.borderColor = "green";
        } else {document.getElementById("input_cpf").style.borderColor = "red";}
    }

    
    function verificar_cep() {
        var cepServer = input_cep.value;
        if (cepServer == "") {
            document.getElementById("input_cep").style.borderColor = "black";
        } else if (cepServer.indexOf('-') > -1 && cepServer.length == 9) {
            document.getElementById("input_cep").style.borderColor = "green";
        } else {document.getElementById("input_cep").style.borderColor = "red";}
    }

    function verificar_rua() {
        var ruaServer = input_rua.value;

        if (ruaServer == "") {
            document.getElementById("input_rua").style.borderColor = "black";
        } else if (ruaServer.length > 5) {
            document.getElementById("input_rua").style.borderColor = "green";
        } else {document.getElementById("input_rua").style.borderColor = "red";}
    }
    
    function verificar_num() {
        var num_eServer = input_numero.value;

        if (num_eServer == "") {
            document.getElementById("input_numero").style.borderColor = "black";
        } else if (num_eServer.length > 1) {
            document.getElementById("input_numero").style.borderColor = "green";
        } else {document.getElementById("input_numero").style.borderColor = "red";}
    }


    function verificar_cidade() {
        var cidadeServer = input_cidade.value;
        if (cidadeServer == "") {
            document.getElementById("input_cidade").style.borderColor = "black";
        } else if (cidadeServer.length >= 1) {
            document.getElementById("input_cidade").style.borderColor = "green";
        } else {document.getElementById("input_cidade").style.borderColor = "red";}
    }


    function verificar_estado() {
        var cidadeServer = input_estado.value;
        if (cidadeServer == "") {
            document.getElementById("input_estado").style.borderColor = "black";
        } else if (cidadeServer.length >= 1) {
            document.getElementById("input_estado").style.borderColor = "green";
        } else {document.getElementById("input_estado").style.borderColor = "red";}
    }


    function cadastrar() {
        var nomeServer = input_nome.value;
        var sobrenomeServer = input_sobrenome.value;
        var emailServer = input_email.value;
        var senhaServer = input_senha.value;
        var senha_confirmServer = input_senha_confirmacao.value;
        var nome_empresaServer = input_nome_empresa.value;
        var telefoneServer = input_telefone.value;
        var cnpjServer = input_cnpj.value;
        var cpfServer = input_cpf.value;
        var cepServer = input_cep.value;
        var num_eServer = input_numero.value;
        var cidadeServer = input_cidade.value;
        var ruaServer = input_rua.value;
        var estadoServer = input_estado.value;

        // Se os campos estão vazios
        if (nomeServer == "" || sobrenomeServer == "" || emailServer == "" || senhaServer == "" || nome_empresaServer == "" || telefoneServer == "" || cnpjServer == "" || cpfServer == "" || enderecoServer == "" || cepServer == "" || num_eServer == "" || cidadeServer == "" || ruaServer == "" || estadoServer == "") {
            alert("Preencha todos os campos");
        } else if (nomeServer.length <= 3) {
            alert("O nome deve ter mais de 2 caracteres");
        } else if (sobrenomeServer.length < 3) {
            alert("O sobrenome deve ter mais de 2 caracteres");
        } else if (emailServer.indexOf("@") == -1 || (emailServer.indexOf("sptech.school") == -1 && emailServer.indexOf(".com") == -1 && emailServer.indexOf(".com.br") == -1)) {
            alert("E-mail inválido!");
        } else if (senhaServer.length < 8) {
            alert("Sua senha deve ter no mínimo 8 caracteres");
        } else if (senhaServer != senha_confirm) {
            alert(`A confirmação de senha está incorreta`);
        } else if (telefoneServer.indexOf("-9", 2) == -1 || telefoneServer.length > 12 && telefoneServer.length <= 12) {
            alert("O número deve conter 12 dígitos e '-9' após o DDD")
        } else if (cnpjServer.indexOf("0001-") == -1 || cnpjServer.length > 15 && cnpjServer.length <= 15) {
            alert("O CNPJ deve conter 14 dígitos e '0001-' antes dos dois dígitos finais.");
        } else if (cpfServer.indexOf("-") == -1 || cpfServer.length > 12 && cpfServer.length <= 12) {
            alert('O CPF deve conter 11 dígitos e um - antes dos dois dígitos finais.')
        } else if (cepServer.indexOf('-') == -1 || cepServer.length > 9 && cepServer.length <= 9) {
            alert('O CEP deve ter 8 dígitos e conter um - antes dos 3 dígitos finais')
        } else {
            // Enviando o valor da nova input
            fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                sobrenomeServer: sobrenomeVar,
                emailServer: emailVar,
                senhaServer: senhaVar,
                telefoneServer: telefoneVar,
                nome_empresaServer: nome_empresaVar,
                cnpjServer: cnpjVar,
                cpfServer: cpfVar,
                cepServer: cepVar,
                numServer: numVar,
                cidadeServer: cidadeVar,
                ruaServer: ruaVar,
                estadoServer: estadoVar
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {

                alert(`Cadastro realizado com sucesso! Redirecionando para tela de Login...`)

                setTimeout(() => {
                    window.location = "../login/login.html";
                }, "2000")
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

        return false;
        }
    }
</script> -->